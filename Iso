Below is a clean, reusable Ansible automation that generates Bootstrap + Master ISOs using coreos-installer iso customize, exactly matching the commands you ran manually.

This is suitable for OpenShift UPI / Agent-based / Static (none platform) installs like the one youâ€™re doing.


---

ğŸ“ Recommended Directory Layout

ocp-isoMNO/
â”œâ”€â”€ playbook-generate-isos.yml
â”œâ”€â”€ vars.yml
â”œâ”€â”€ files/
â”‚   â”œâ”€â”€ coreos-installer
â”‚   â”œâ”€â”€ rhcos-418.94.202508060022-0-live.x86_64.iso
â”‚   â”œâ”€â”€ boot-enp0s8.nmconnection
â”‚   â”œâ”€â”€ m1-ens1f0.nmconnection
â”‚   â”œâ”€â”€ m2-ens1f0.nmconnection
â”‚   â”œâ”€â”€ m3-ens1f0.nmconnection
â”œâ”€â”€ ignitions/
â”‚   â”œâ”€â”€ bootstrap.ign
â”‚   â””â”€â”€ master.ign
â””â”€â”€ output/


---

ğŸ“Œ vars.yml

# vars.yml
dest_device: /dev/sda

rhcos_iso: rhcos-418.94.202508060022-0-live.x86_64.iso

coreos_installer: coreos-installer

ignition_dir: ignitions
nmconnection_dir: files
output_dir: output

nodes:
  - name: bootstrap
    ignition: bootstrap.ign
    nmconnection: boot-enp0s8.nmconnection
    output_iso: bootstrap.iso

  - name: master1
    ignition: master.ign
    nmconnection: m1-ens1f0.nmconnection
    output_iso: master1.iso

  - name: master2
    ignition: master.ign
    nmconnection: m2-ens1f0.nmconnection
    output_iso: master2.iso

  - name: master3
    ignition: master.ign
    nmconnection: m3-ens1f0.nmconnection
    output_iso: master3.iso


---

â–¶ï¸ playbook-generate-isos.yml

---
- name: Generate OpenShift RHCOS customized ISOs
  hosts: localhost
  become: false
  vars_files:
    - vars.yml

  tasks:

    - name: Ensure output directory exists
      file:
        path: "{{ output_dir }}"
        state: directory
        mode: '0755'

    - name: Ensure coreos-installer is executable
      file:
        path: "{{ coreos_installer }}"
        mode: '0755'

    - name: Generate ISOs for Bootstrap and Masters
      command: >
        ./{{ coreos_installer }} iso customize
        --dest-device {{ dest_device }}
        --dest-ignition {{ ignition_dir }}/{{ item.ignition }}
        --network-keyfile {{ nmconnection_dir }}/{{ item.nmconnection }}
        -o {{ output_dir }}/{{ item.output_iso }}
        {{ rhcos_iso }}
      args:
        chdir: "{{ playbook_dir }}"
      loop: "{{ nodes }}"
      loop_control:
        label: "{{ item.name }}"
      register: iso_creation

    - name: Show ISO creation output
      debug:
        var: iso_creation.results


---

â–¶ï¸ Run the Playbook

ansible-playbook playbook-generate-isos.yml


---

âœ… Output

output/
â”œâ”€â”€ bootstrap.iso
â”œâ”€â”€ master1.iso
â”œâ”€â”€ master2.iso
â””â”€â”€ master3.iso

Each ISO will:

Auto-install to /dev/sda

Use the correct Ignition

Apply the correct static network config

Require no confirmation at boot



---

ğŸ”¥ Optional Enhancements (Can add next)

SHA256 checksum generation

HTTP copy to /var/www/html/iso/

Redfish / iLO virtual media attach

Day-2 worker ISO generation

Full Day-0 + Day-2 Ansible role structure


If you want, I can:

Convert this into an Ansible role

Add iLO/Redfish automation

Integrate with your HAProxy + DHCP + DNS


Just tell me ğŸ‘
